# Issues when Transforming FHIR to OMOP
Challenges arise aligning  FHIR resources and the OMOP Common Data Model (CDM) due to differences in data structures and the underlying scope and purpose when using each in deployed systems.   An additional layer of complexity lies in the fact that few observational data sources are generated as native FHIR, so many FHIR resources have previously undergone a transformation onto FHIR in support of data exchange scenarios. As such, there is a need for a pragmatic approach to aligning FHIR and OMOP that preserves not only key context of the source data represented in a formation that supports transactional use cases, but also attains conformance to OMOP as a target specification supporting analytics. 

Given the inherent differences in scope and purpose of the two models, this implementation guide focuses on high-confidence mappings, providing annotation in areas where assumptions are made.  Our goal is to provide rationale and clear conventions where details applicable to all cases of FHIR to OMOP transformations may be lacking. This guide is intended to be the foundation upon which refinement addressing specific use cases can be based.  Testing at Connectathons and standard HL7 user feedback processes will validate and / or enhance our proposed strategies and ensure the conventions and mappings provided are robust and practical for a variety of use cases.
FHIR by design supports real-time clinical data exchange within healthcare systems, emphasizing data interoperability and clinical workflows. OMOP is structured for research and analytics, focusing on retrospective analysis and standardized terminology. The implication of these differences includes that under-considered or incomplete mappings can misrepresent data because FHIR's real-time, workflow-oriented approach doesn’t always align with OMOP’s longitudinal approach to data.  The OMOP approach and data model requires compliance to concept standardization and assumes that data has been validated by data quality procedures ensuring its consistency. Specific aspects of patient records on FHIR that require special consider when transforming to OMOP follow.

## Identifiers, De-identitification & Privacy
## External Identifier Management
The OMOP CDM is designed to be a de-identified data model, but not necessarily fully anonymized. Some implementation use cases require systems that maintain traceability between FHIR resources and OMOP records. This requires external identifier tracking mechanisms. FHIR resources often utilize complex, non-integer identifiers that do not directly correspond to OMOP's integer-based key structures. Implementers may choose to include external ID tracking protocols to preserve the relationship between source FHIR Observation resources and their corresponding OMOP records. This tracking supports audit trails, data validation processes, and enables bidirectional mapping verification. While external identifier management extends beyond this implementation guide's scope, it represents a critical component for practical ETL processes and can ensures data provenance throughout a transformation pipeline.

## Record Identifier management
As is customary for relational databases, identifiers in the OMOP Common Data Model are used to establish relationships between tables. Notably, the person_id is used as a foreign key in OMOP to link conditions, procedures, drug exposures and other clinical domain tables. However, data residing on OMOP is de-identified as a default where no fields contain data that are patient identifiable information (PII), such as Medical Record Numbers, names or addresses. In FHIR, identifiers provide a similar function in that they link discrete data occurring in separate FHIR resources to individual patients, but identifiers in FHIR also provide reference information about and / or residing in the source systems that generate data in FHIR resources to support workflows and transactions between systems.  In practice, many OMOP implementations reside within system architectures that have business requirements for re-identification supporting learning health systems scenarios, research recruitment or other use cases.   For these instances, maintaining traceability from OMOP back to the FHIR source could be crucial for continuous learning and other virtuous feedback loops leveraging the use of observational data. Simply stated, there is not a single approach that we can provide in the scope identified for this guide that can be uniformly applied to transformation of FHIR identifiers to OMOP.  Rather, implementers must evaluate FHIR identifiers in terms of 

* Research the OMOP instance is intended to support
* Purpose / role of the identifier in the FHIR resource
* Whether the FHIR identifier may, in fact, inform clinical facts in the observational data store
* Format (length) of the identifier

A primary concern when implementing FHIR to OMOP transformations that include raw identifiers directly from source systems is in doing so, there could be compromises in the de-identification process: a cornerstone of OMOP's design for use in research and analytics. OMOP is not designed to support business identity management use cases, and using fields like `visit_source_value` to store FHIR identifiers could misrepresent their intended use as generated in source EHRs. A potential solution is to ignore identifiers in the direct mapping process or stored in a separate structure outside of OMOP’s core tables to maintain traceability.  Creating a separate data source table that maps OMOP-generated IDs to the original FHIR identifiers can accommodate the complexities of handling identifiers for retaining provenance and traceability without compromising the de-identification and usability standards, disrupting the OMOP schema or violating its de-identification protocols.

Implementers of FHIR to OMOP transformations must balance how an identifier presents in the source FHIR resource(s), the technical requirements and permissible use of OMOP per the CDM specification. This involves choosing how to manage identifiers based on the specific needs and system constraints of the implementation, while maintaining compliance with data privacy and usability standards.  More specifically, differing database systems such as Google BigQuery, AWS Redshift… have varying constraints on integer sizes. This may complicate storing FHIR identifiers directly as OMOP IDs. It can also be challenging to find a suitable place for these identifiers within the OMOP Common Data Model (CDM), which does not have a direct equivalent field specifically designed for business identifiers associated with encounters.

An example of this type of challenge is apparent when evaluating the ‘encounter.identifier’ element in the FHIR Encounter resource.  This element captures a business identifier for the encounter, which in any source data may reflect a variety of identifiers such as medical record numbers, encounter IDs, or any unique values used by healthcare systems to track individual encounters. One solution would be to use `visit_occurrence_id`as a target in OMOP, as this is a unique identifier for each record in the `visit_occurrence` table aligned with the meaning of the data element in FHIR. However, in consideration for the need for traceability, data integrity, and compliance with de-identification standards, this primary key is typically generated in OMOP as a sequence to ensure anonymity and maintain referential integrity across the OMOP instance. Another solution would be to map FHIR `Encounter.identifier` to the OMOP`visit_source_value`a field that can hold the original value from the source data that describes the encounter type. However, depending on the convention used for generating this identifier in source upstream of FHIR, there are concerns regarding the appropriateness of using this field for identifiers, which are not descriptive values but unique business identifiers. Further, `visit_source_value` in OMOP often aligns more with descriptive elements in FHIR like `Encounter.period` or `Encounter.type`, which are codeable concepts in FHIR and not necessarily identifiers. 

There could be limitations to the ability of fields in an OMOP database to store some identifiers, particularly GUIDs or more complex strings that exceed, for example, the varchar(50) character limit specified in `visit_source_value.`  Identifiers in source systems may have missing context resulting in ambiguous meanings such as reflected in the following

  ```json
       "identifier": [
         {
           "system": "https://hospital.makedata.ai",
           "value": "b9d8ed9e-1b1a-4e30-9ee3-af66f4a61cff"
         }
       ]
```

Additionally, identifiers can be complex with nested elements:

       ```xml
       <identifier>
         <use value="official" />
         <system value="http://www.acmehosp.com/patients" />
         <value value="44552" />
         <period>
           <start value="2003-05-03" />
         </period>
       </identifier>
       ```
These examples highlight the complexity and variability of identifiers in FHIR, emphasizing why a one-size-fits-all mapping in OMOP is not practical. As such we recommend an evaluation on a case-by-case basis of the available FHIR identifier elements and their meaning in the source system to determine an appropriate target in OMOP, adoption of a separate facility or extension table(s) with the express purpose of storing source identifiers or ignoring them in the transformation altogether. 

## Status and Intent Elements in FHIR Resources
Many FHIR resources, like MedicationRequest or Procedure, have status fields indicating administrative or health care delivery process stages (e.g., planned, completed, in progress).  OMOP, on the other hand, represents concepts that are clinical facts, which implies that only completed activities should be mapped for accurate data analysis. This creates an expectation of specific context for the data being mapped. Careful consideration must be made when FHIR data resources also contain populated status and intent fields indicating a measurement, dispensing activity or care delivery service is planned or in process.  Specifically, attention to and disposition of data based on these FHIR elements in a transformation should be consistent within a project or OMOP implementation.  Upon evaluation, there may be a need to filter out incomplete or planned activities when transforming data to OMOP, especially for procedures and medications. Including such data could introduce bias or misrepresent actual patient exposure, leading to inaccuracies in research.  This kind of filtering and its rationale should be documented so that the rules are applied consistently to data ingress pipelines for as long as the OMOP instance is in use. 

The business context of FHIR Medication Requests versus the OMOP Drug Exposure domain is an example where representation and evaluation of the medication status is needed as a component of a properly executed data transformation. FHIR MedicationRequests resources represent prescriptions  or orders, which do not in and of themselves guarantee that the patient actually ingested the medications. In contrast, OMOP’s drug_exposure table is intended to capture actual medication exposure. But medication orders and prescriptions are commonly used in observational research as assumed proxies for exposure to medications.  As such, particular attention must be made to populate the required drug_exposure entries derived from MedicationRequest data through assignment of an appropriate drug_type_concept_id that clearly indicates the data are derived from a prescription rather than known ingestion. This approach allows downstream users to filter based on what is known to be true about the exposure to a medication and retain valuable prescribing or dispensing records in the research data store. 

## Data Completeness, Missiness &  Integrity

### Handling Incomplete or Partial Data
Handling incomplete or partial data presents an additional challenge in transforming FHIR resources to OMOP. FHIR records are often incomplete for several reasons: the source electronic health record (EHR) itself may contain partial entries, or the FHIR resources may only include a subset of available data tailored to the specific purpose of the resource. In contrast, the OMOP data model assumes that critical fields such as dates, person references, and coded concepts are consistently populated to support standardized analysis.

When transforming FHIR to OMOP, these gaps require careful consideration to avoid introducing ambiguity or bias. For example, a FHIR MedicationStatement may be missing start or end dates, which makes it unclear whether the medication should be interpreted as active, historical, or intended. Similarly, a procedure or encounter record may lack information about the performer or the location, undermining the ability to analyze provider performance, regional variation, or care delivery patterns.

One approach to address these challenges is to consider fallback strategies that preserve as much context as possible. Implementers can use the OMOP observation domain or the note table to retain essential but incomplete data when no direct mapping is feasible. In cases where fields such as dates are missing, records can be flagged as incomplete by selecting appropriate ‘type’ concept IDs to indicate that the data is estimated or partial. This practice ensures that analysts reviewing the transformed data are aware of the uncertainty inherent in these records.

It is equally important for implementers to reflect on the implications of partial data for downstream analyses. Records with incomplete information may introduce misinterpretation or bias if not carefully accounted for in study design and statistical modeling. Therefore, teams should exercise caution when drawing inferences from datasets containing records transformed from incomplete FHIR sources.

### Temporal Completeness and Missing Dates 
[see also: Temporal Precision Models: OMOP vs FHIR](https://github.com/HL7/fhir-omop-ig/blob/main/input/pagecontent/F2OSpecificIssues..md#temporal-precision-models-omop-vs-fhir) 

Temporal information in FHIR plays a critical role in accurately representing the timing and sequence of healthcare events. However, mapping this information into the OMOP data model can be challenging when dates are missing or ambiguous. FHIR resources often rely on elements such as effectiveDateTime, period, or endDate to define when an event occurred, but this information is frequently incomplete or approximate, especially in historical records or patient-reported data.

Missing or estimated dates introduce substantial risks to data quality and analytic precision. For example, when a FHIR Procedure resource lacks an end date, it becomes unclear whether the procedure was completed or remains ongoing, which complicates the construction of care timelines. Similarly, approximate dates can undermine the reliability of studies requiring precise event sequencing or duration calculations.

To mitigate these issues, implementers should explicitly document limitations in date precision. One approach is to record such records in the OMOP observation_period table or apply custom flags to indicate that date information is incomplete or uncertain. When dates are ambiguous, the Implementation Guide recommends using the recorded date as a proxy and reflecting the uncertainty by setting an appropriate observation_type_concept_id.

Where feasible, standard conventions should be applied to improve consistency. For example, if only a month is known, the date may default to the first day of that month. In cases where no precise day is available, a median estimate can be used to maintain temporal coherence while preserving clarity about the inherent limitations of the source data. These practices help ensure that analyses remain as robust as possible despite unavoidable gaps in temporal detail.

### Contextual Gaps in Data Mapping
A challenge faced in transforming FHIR to OMOP is that FHIR resources often contain contextual elements such as `reasonCode`, `performer`, `location`, or `supportingInfo` that help clarify the conditions or context surrounding a clinical event. OMOP tables do not have a direct way to represent these contexts fully in the same way that FHIR has structured this information. While core information may be mapped to OMOP fields in most instances, key context might be lost if certain contextual elements cannot be directly represented, impacting downstream analytics. For example, `reasonCode` in FHIR can specify the purpose of a procedure, such as preventive care vs. diagnostic intervention. This nuance can be critical to outcomes analyses but may not be directly captured in OMOP.  Also of issue is that lacking context, such as missing details on “why” a procedure was performed or medication prescribed could lead to misinterpretations in analysis, particularly for longitudinal studies tracking disease progression or treatment efficacy. 
   
One workaround could be to capture the context in an OMOP extension, such as "note," but this would have limitations.  Further, any extension suggested as universally applicable for FHIR source data would suggest implementation of OMOP CDM non-conformant as a routine. Rather, for the scope of this implementation guide, we want to call attention to the limitation and suggest review of the source data for potential proxies in the choices made for target Standard concepts, special attention to selection of record ‘type’ concepts that confer metadata about the source records or ensuring linkage in the transformed data to specific `visit_occurrence` records to approximate some context potentially lost. As suggested with identifiers, if the contextual information potentially lost in transformation cannot be accommodated and is critical to the research intended, then accommodation with concept or table extensions may be considered. 

### Flavors of Null on OMOP

## Data Absent Reasons Elements
The Data Absent Reason element in FHIR allows implementers to record why information is missing or incomplete in observations, medication statements, and immunizations. When using FHIR resources that document reasons for absent data, it is important to assess carefully which of these reasons should be included in OMOP. This consideration applies to common scenarios such as missing lab results, medications that were not administered, or declined immunizations.

Because Data Absent Reasons cover a spectrum ranging from clinically meaningful refusals to routine administrative gaps, a selective approach is recommended. Implementers are encouraged to map only those reasons with clear clinical or research value for the intended use case—which may include or exclude information such as patient refusals, or  adverse reactions —while excluding operational or ambiguous reasons like “unknown” or “unsupported.” 

In FHIR, Data Absent Reasons use codes such as “unknown,” “not asked,” “asked but unknown,” and “not applicable,” reflecting nuances in why data were not captured. For example, a lab result ordered but not performed could be marked “patient declined,” while a medication not taken might be recorded as due to side effects.
Determining how to represent FHIR’s Data Absent Reasons in OMOP requires both technical and clinical considerations. Because FHIR reasons encompass both clinical and operational rationale, it is recommended to retain only clinically significant reasons that can be mapped to standard vocabularies such as SNOMED or OMOP concepts. This approach helps implementers balance the completeness of data capture with the need for clarity and analytic utility, preserving the clinical relevance and analytic focus of the OMOP model to support the intended research use cases.

## Temporal Precision Models: OMOP vs FHIR 

In the OMOP Common Data Model, temporal precision represents the degree to which recorded dates and times accurately represent healthcare events. This approach differs fundamentally from FHIR in both philosophy and implementation. While FHIR supports sub-day timestamps down to milliseconds to accommodate real-time clinical workflows and operational interoperability, OMOP prioritizes date-level precision using the YYYY-MM-DD format. This design reflects OMOP's focus on large-scale observational studies and retrospective research where day-level granularity typically provides sufficient resolution for meaningful analyses.

OMOP operates on the assumption that date-level granularity supports most healthcare research use cases, including longitudinal analyses, cohort definitions, and temporal trend studies. This standardization facilitates meaningful comparisons across datasets while reducing variability from different recording practices across healthcare systems. The elimination of sub-day precision reduces analytical complexity and standardizes temporal comparisons across diverse healthcare datasets, supporting the model's primary mission of enabling reproducible observational research.

### Fundamental Approach and Domain Requirements
OMOP defines temporal precision as the smallest unit of time recorded, typically the date. Most temporal fields are implemented as DATE data types, storing information exclusively in YYYY-MM-DD format. For example, condition_start_date records when a condition began but excludes time-of-day information to maintain consistency across diverse data sources. This standardization enables reliable comparative analyses while acknowledging that most observational research questions can be adequately addressed with date-level precision.
Different OMOP domains emphasize temporal precision based on their analytical importance. Critical clinical events like condition occurrences, drug exposures, and procedures require exact dates. For instance, a diabetes diagnosis must specify the exact date (2024-01-15), as must prescription fills (2024-02-10) and surgical procedures (2023-11-20). Laboratory observations prefer exact dates when available, such as recording a lab test on 2023-10-05. Visit occurrences require both precise start and end dates to capture healthcare encounters accurately, like an inpatient admission spanning 2024-03-01 to 2024-03-05.
End dates present particular challenges since they're frequently unavailable for chronic conditions or ongoing treatments. The OMOP CDM permits null values in this instance rather than requiring potentially misleading imputed dates, distinguishing between required temporal fields like condition_start_date and optional fields like condition_end_date, recognizing that certain temporal information may be inherently unavailable.

### Design Limitations and Analytical Applications
The approach the OMOP CDM imposes limitations where sub-day precision matters. Intensive care settings where exact timing of interventions or measurements is clinically significant may lose critical fidelity. Temporal ties, where multiple events occur on the same day, require additional disambiguation strategies since the model cannot determine intra-day sequencing.
Despite these limitations, OMOP's temporal model supports diverse analytical applications. Cohort definitions rely on temporal fields to establish time-bound inclusion criteria, such as identifying patients diagnosed with hypertension within specific timeframes. Event sequencing analyses use day-level granularity to establish temporal relationships between diagnoses, procedures, and treatments, supporting comparative effectiveness research and clinical pathway analysis.

### Implementation and Data Management Considerations
When source data provides only partial temporal information, OMOP enforces specific conventions while maintaining data integrity. If only a year is known, implementers might use placeholder values like 2024-01-01. This may have downstream consequences to analytics using these data, creating bias. Thus such decisions require thorough ETL documentation and should be available to all data users to incorporate in analytic assumptions and modeling. These data conditions must also be available to data users to appropriately inform utilization of transformed data in analytics.

The OMOP CDM encourages auxiliary fields to document temporal data sources and derivation methods. Source value fields like *_source_value retain original timestamps from source systems, while metadata tables document imputation or logical inference processes. This provenance tracking ensures downstream analysts understand the limitations in the underlying temporal aspect of their data.
Successful OMOP temporal precision implementation requires careful consideration of source data characteristics and analytical requirements. ETL developers must establish clear conventions for handling partial dates and document these decisions to ensure consistent interpretation across data sources. The model's balance between standardization and flexibility enables adaptation to diverse healthcare settings while preserving analytical capabilities essential for observational research.

Understanding OMOP's temporal precision model is crucial for health data professionals, as it influences ETL design decisions and analytical methodology selection. While the date-level precision approach has limitations, it provides a robust foundation for the observational research applications that represent OMOP's primary use case.
