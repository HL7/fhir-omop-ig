# IPA Profile-specific issues
## Handling of Procedure and Observation Resources
Naturally, there is variability in source EHR data representation, where each EHR may represent the same clinical activity differently when exported to FHIR. For instance, some procedures in FHIR are represented in the Measurements or Observations domains in OMOP, such as lab orders and diagnostic imaging. It is a mapping challenge in deciding whether to map individual activities to the OMOP Procedure Occurrence, Measurement, or Observation domains. As alluded to previously, this is determined by domain assignment of the target OMOP concept_id(s) for any given procedure represented on FHIR.  An evaluation of each source procedure that differentiates true procedures (e.g., surgeries) from diagnostic activities is necessary to avoid FHIR procedure resource data misclassification.

## Handling Encounters and Contextual Data
In FHIR, procedures, medications, and other clinical actions are often linked to an encounter for context. OMOP has Visit Occurrence and Visit Detail tables that provide temporal and venue-specific clinical context.  However, inconsistencies in how encounters are represented across FHIR resources and systems present challenges to consistent data transformation. Mapping encounter data to OMOP’s visit_occurrence table and populating other domains with a visit_occurence_concept_id foreign key should be done wherever possible.  However, an evaluation of how consistent the source data are in representing encounters will determine whether there may be some flexibility required in a FHIR to OMOP transformation.

## Data Absent Reason Examples 
For observations like labs or vital signs, capturing the reason for missing data can be clinically useful when the reason directly impacts care. Knowing that a lab was not completed because of a processing error clarifies whether the absence represents a true gap in care or simply a data issue. Reasons that are purely operational, such as “not applicable,” generally do not add research value and may be omitted if appropriate to the analysis.
In medication data, reasons for discontinuation or non-use—such as adverse reactions, patient nonadherence, or contraindications—can inform research on medication safety, adherence, and treatment effectiveness. These reasons can be selectively included to support such studies. Routine logistical issues and administrative gaps are less likely to contribute meaningfully to OMOP analyses and can be excluded.

For immunizations, the value of documenting vaccines that were not administered requires special consideration. Refusals or contraindications may be relevant for research on vaccine hesitancy or public health trends, while routine administrative noncompletions typically have little analytic value and can be left out. OMOP’s Measurement Value Domain may be used to store absent data reasons for labs and imaging, as these often have clinical implications. 

Data absent reasons such as “insufficient sample,” “not detected,” or “patient declined” may be included for labs and imaging to enrich analytic context. For immunizations, documentation can focus on significant refusals or contraindications, while administrative reasons are generally excluded. 

## Condition Start Date vs. Recorded Date
When implementing FHIR-to-OMOP transformations, two temporal concepts require careful consideration due to their distinct semantic meanings and downstream analytical impact. Understanding these differences is crucial for health data professionals working on interoperability projects and clinical data warehousing initiatives.

### Understanding Condition Start Date
The condition start date represents the clinically determined onset of the condition and forms the foundation of temporal analysis in clinical research. In FHIR implementations, this information is primarily sourced from Condition.onsetDateTime or Condition.onsetPeriod fields. When these explicit onset fields are unavailable, ETL developers often need to implement fallback logic that examines Condition.assertedDate or extract temporal information from clinical notes through natural language processing or manual extraction processes.
This temporal marker maps directly to CONDITION_OCCURRENCE.condition_start_date in the OMOP Common Data Model. The clinical significance of this field cannot be overstated, as it serves as the cornerstone for temporal analyses, disease progression modeling, and epidemiological cohort studies where clinical timeline accuracy is paramount for valid research outcomes.

### The Role of Recorded Date
In contrast to the clinical onset, the recorded date captures when the condition was actually documented in the source system. This administrative timestamp reflects the healthcare workflow and documentation practices rather than the clinical reality of disease onset. In FHIR resources, this information is typically found in Condition.recordedDate, though the availability of this field varies significantly across different EHR implementations and vendor configurations.
The challenge for OMOP implementers lies in the fact that the Common Data Model lacks a native equivalent field for recorded dates. This architectural decision reflects OMOP's focus on clinical events rather than administrative metadata. However, several implementation strategies can address this gap, including the development of custom extensions within the CONDITION_OCCURRENCE table, creation of dedicated metadata tables for comprehensive provenance tracking, utilization of the NOTE table with structured content, or establishment of separate ETL audit tables that maintain this temporal information alongside the clinical data.

### Implementation Challenges and Considerations
The fundamental challenge in FHIR-to-OMOP mapping stems from a data model alignment issue where OMOP's clinical-event focus prioritizes onset information over administrative timestamps. This philosophical difference requires architects and implementers to make deliberate decisions about how to preserve recorded date information when audit requirements or analytical needs demand such provenance tracking.
Missing data scenarios present particular complexity for ETL developers. When onsetDateTime is unavailable in the source FHIR data, the temptation exists to use recordedDate as a proxy for clinical onset. While this approach may seem pragmatic, it introduces analytical bias that can significantly impact downstream research and clinical decision-making. Such substitutions must be thoroughly documented in ETL metadata and clearly communicated to end users.
Temporal discrepancies between onset and documentation dates often reveal interesting patterns in healthcare delivery and documentation practices. Significant lags between when a condition clinically manifests and when it gets recorded in the EHR can affect different use cases in distinct ways, with clinical analyses requiring accurate onset timing while operational assessments may depend more heavily on documentation patterns.

### Condition Date Implementation Strategies
The implementation of date prioritization logic typically follows a preference hierarchy that favors onset dates when available while providing documented fallback mechanisms to recorded dates when clinical onset information is absent. This logic should be configurable to accommodate different analytical requirements and source system characteristics.
A technique that may be overlooked involves leveraging the condition_type_concept_id field to indicate the source and quality of temporal information. By using concept codes that distinguish between "EHR onset date" and "EHR recorded date," downstream analysts can make informed decisions about which temporal markers are most appropriate for their specific research questions.
